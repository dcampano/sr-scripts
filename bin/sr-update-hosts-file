#!/usr/bin/env ruby

require 'rubygems'
require 'fog'

connection = Fog::Compute.new(:provider => "AWS", :region => "us-west-1")
sdb = Fog::AWS::SimpleDB.new()

rows = sdb.select("SELECT * FROM dns_info").body["Items"]

if rows.length > 0
	File.open('/etc/hosts', 'w') { |f|
		f.puts "# THIS FILE MANAGED BY sr-update-hosts SCRIPT"
		f.puts "127.0.0.1 localhost localhost.localdomain"
		rows.each_pair { |item_name, values|
			f.puts "#{values['ip_address']} #{item_name}"
		}
	}
end
